<?xml version="1.0" encoding="UTF-8"?>
<mapper namespace="com.demo.TestMapper">
  <sql id="BaseCols">id, name, age, city</sql>

  <select id="paramSingle">
    SELECT * FROM t_user
    <where>
      <if test="value != null"> id = #{value} </if>
    </where>
  </select>

  <select id="paramMulti">
    SELECT * FROM t_user123
    <where>
      <if test="uid != null"> AND id = #{uid} </if>
      <if test="uname != null"> AND name = #{uname} </if>
    </where>
  </select>

  <select id="rawOrder">
    SELECT * FROM t_user ORDER BY ${order}
  </select>

  <select id="ifTests">
    SELECT * FROM t_user
    <where>
      <if test="x != null"> AND id = #{x} </if>
      <if test="s != null &amp;&amp; s != ''"> AND name = #{s} </if>
      <if test="z != null &amp;&amp; z != 0"> AND age = #{z} </if>
    </where>
  </select>

  <select id="chooseTests">
    SELECT * FROM t_user
    <where>
      <choose>
        <when test="a != null"> id = #{a} </when>
        <when test="b != null"> name = #{b} </when>
        <otherwise> city = 'X' </otherwise>
      </choose>
    </where>
  </select>

  <select id="trimTests">
    SELECT * FROM t_user
    <trim prefix=" WHERE" prefixOverrides="AND,OR" suffixOverrides=",">
      AND name = #{name},
      OR city = #{city},
    </trim>
  </select>

  <update id="setTests">
    UPDATE t_user
    <set>
      <if test="name != null"> name = #{name}, </if>
      <if test="age != null"> age = #{age}, </if>
    </set>
    WHERE id = #{id}
  </update>

  <select id="foreachList">
    SELECT * FROM t_user
    <where>
      <if test="ids != null &amp;&amp; !isEmpty(ids)">
        id IN
        <foreach collection="ids" item="x" open="(" close=")" separator=","> #{x} </foreach>
      </if>
    </where>
  </select>

  <select id="foreachArray">
    SELECT * FROM t_user
    <where>
      id IN <foreach collection="arr" item="x" open="(" close=")" separator=","> #{x} </foreach>
    </where>
  </select>

  <select id="foreachMap">
    SELECT * FROM t_user
    <where>
      id IN <foreach collection="mp" item="v" index="k" open="(" close=")" separator=","> #{v} </foreach>
    </where>
  </select>

  <select id="includeWithProp">
    SELECT <include refid="BaseCols"><property name="extra" value="'ok'"/></include> FROM t_user
  </select>

  <sql id="frag">
    col = #{val}
  </sql>

  <select id="includeFrag">
    SELECT * FROM t_user WHERE <include refid="frag"><property name="val" value="x"/></include>
  </select>

  <select id="bindTests">
    <bind name="k" value="a + 1"/>
    SELECT * FROM t_user WHERE id = #{k}
  </select>

  <select id="nested">
    SELECT * FROM t_addr
    <where>
      <if test="user != null &amp;&amp; user.addr != null"> city = #{user.addr.city} </if>
    </where>
  </select>

  <select id="literals">
    SELECT * FROM t_lit
    <where>
      s = #{s} AND d = #{d} AND dt = #{dt} AND t = #{t} AND n = #{n} AND b = #{b} AND e = #{e} AND u = #{u}
    </where>
  </select>

</mapper>